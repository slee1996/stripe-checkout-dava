<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Stripe Checkout Sample</title>
    <meta name="description" content="A demo of Stripe Payment Intents" />

    <!-- Load Stripe.js on your website. -->
    <script src="https://js.stripe.com/v3/"></script>
    <script>
    // Create a Checkout Session with the selected plan ID
        var createCheckoutSession = function(priceId) {
            return fetch("/create-checkout-session", {
              method: "POST",
              headers: {
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                priceId: priceId
              })
            }).then(function(result) {
                console.log(result)
              return result.json();
            }).catch(err => console.log(err));
        };
          
          // Handle any errors returned from Checkout
        var handleResult = function(result) {
            if (result.error) {
              var displayError = document.getElementById("error-message");
              displayError.textContent = result.error.message;
            }
          };
          
          /* Get your Stripe publishable key to initialize Stripe.js */
          fetch("/setup")
            .then(function(result) {
              return result.json();
            })
            .then(function(json) {
              var publishableKey = json.publishableKey;
              var basicPriceId = json.basicPrice;
              var proPriceId = json.proPrice;
          
              var stripe = Stripe(publishableKey);
              // Setup event handler to create a Checkout Session when button is clicked
              document
                .getElementById("cool-button")
                .addEventListener("click", function(evt) {
                  createCheckoutSession(basicPriceId).then(function(data) {
                    console.log(data)
                    // Call Stripe.js method to redirect to the new Checkout page
                    // stripe
                    //   .redirectToCheckout({
                    //     sessionId: data.sessionId
                    //   })
                    //   .then(handleResult);
                  });
                });
            
        });
        </script>
  </head>

  <body>
    <div class="sr-root">
      <div class="sr-main" style="display: flex;">
        <header class="sr-header">
          <div class="sr-header__logo"></div>
        </header>
        <div class="sr-container">
          <section class="container basic-photo">
            <div>
              <h1>Basic subscription</h1>
              <h4>1 photo per month</h4>
              <div class="pasha-image">
                <img
                  src="https://picsum.photos/280/320?random=4"
                  width="140"
                  height="160"
                />
              </div>
            </div>
            <button id="cool-button">$5.00 per month</button>
          </section>
        </div>
        <div id="error-message"></div>
      </div>
    </div>
  </body>
</html>